function injectScript(e,t){var n=document.getElementsByTagName(t)[0],i=document.createElement("script");i.setAttribute("type","text/javascript"),i.setAttribute("src",e),n.appendChild(i)}function injectStyle(e,t){var n=document.getElementsByTagName(t)[0],i=document.createElement("link");i.setAttribute("rel","stylesheet"),i.setAttribute("href",e),n.appendChild(i)}function injectMeta(e,t){const n=document.getElementsByTagName("head")[0],i=document.createElement("meta");i.setAttribute(`data-${e}`,t),i.setAttribute("id",e),n.appendChild(i)}function getTitle(){let e=document.querySelector(".gen-post-link");return e?e.innerText.trim():""}function editAfterAssignmentCreated(e){if(getTitle()===e.assignment_name.trim()){document.querySelector(".folder-contents-cell .action-edit a").click()}}if(document.querySelector('link[href="/sites/all/themes/schoology_theme/print.css"]')||document.querySelector('link[href="/sites/all/themes/schoology_theme/favicon.ico"]')||window.location.origin.match(/^https?:\/\/\S+\.schoology\.com$/)){injectScript(chrome.extension.getURL("notable/integrations/schoology/page_script.js"),"head"),injectStyle(chrome.extension.getURL("notable/integrations/schoology/styles.css"),"head"),injectMeta("tick-url",chrome.runtime.getURL("content/images/tick.svg"));try{chrome.storage.sync.get("notable.user",(function(e){var t=e["notable.user"];if(t){var n=document.getElementsByTagName("head")[0],i=document.createElement("meta");i.setAttribute("id","kamidata"),i.setAttribute("data-kami-user-id",t.id),n.appendChild(i)}}))}catch(e){}window.addEventListener("message",(function(e){"kami-assignment-create"===e.data.event_name&&sessionStorage.setItem("kami-assignment-created",JSON.stringify(e.data))}));let e=sessionStorage.getItem("kami-assignment-created");if(e){sessionStorage.removeItem("kami-assignment-created");try{let t=JSON.parse(e);t.timestamp&&t.timestamp>Date.now()-5e3&&editAfterAssignmentCreated(t)}catch(e){console.log("Error from content script: ",e)}}}if(document.querySelector('link[href="https://asset-cdn.schoology.com/sites/all/modules/schoology_core/s_course/s_course_unified_ui.css"')){const e=window.location.origin,t="https://web.kamihq.com",n=()=>document.location.pathname.match(/^\/assignment\/([0-9]+)/);chrome.runtime.onMessage.addListener((function(i){if(n()){const o=n()[1];if(i.file_link){const n=i.file_link,a=i.filename,r=document.querySelector("._17Z60").innerText,c=n.match(/\/attachment\/([0-9]+)\/source/);if(!c)return;const m=c[1];var s={schoology:{assignment_id:o,assignment_name:r,attachment_id:m,schoology_origin:e}};const l="schoology-"+o+"-attachment-"+m,d=new URL(n),g=new URL(`${t}/web/viewer.html`);g.searchParams.set("file",d.toString()),g.searchParams.set("individual_copy_key",l),g.searchParams.set("source","schoology"),g.searchParams.set("integration_data",JSON.stringify(s)),g.searchParams.set("filename",a),g.searchParams.set("referer",document.location.href),window.open(g.toString(),"_blank")}else i.redirectUrl&&window.location.replace(i.redirectUrl)}}))}