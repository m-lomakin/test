const generatePerPageGraderButton=function(e,t){e.setAttribute("kami-processed",!0);const r=document.createElement("div");r.id=t,r.classList.add("kami-per-page-grader-container"),r.style.visibility="hidden";const a=document.createElement("a");return a.classList.add("kami-per-page-grader-link"),a.innerHTML='<span class="kami-drive-viewer-open-app-icon"></span><span>Grade by Page</span><span class="kami-beta-indicator">beta</span>',a.href="javascript:void(0)",r.appendChild(a),r},attachPerPageGraderButtonGCSubmission=function(e,t){const r=generatePerPageGraderButton(e,t);e.appendChild(r)},attachPerPageGraderButtonGCGrader=function(e,t){const r=generatePerPageGraderButton(e,t),a=e.lastChild;r.classList.add("kami-gc-grader"),e.insertBefore(r,a)},getAssignmentUrlAttributes=function(e){return e(window.location.href)},buildGradeByPageUrl=function(e,t,r,a,n){const i=new URL(`${"https://web.kamihq.com"}/web/viewer.html`),o=i.searchParams;return o.set("ppg_state","search"),o.set("alternate_course_id",e),o.set("alternate_course_work_id",t),o.set("authuser",r),a&&o.set("course_id",a),n&&o.set("course_work_id",n),i.toString()},mountDetailsIframe=function(e,t){const r=getAssignmentUrlAttributes(t);if(!r)return;const[a,n,i]=r,o=`kami-loading-spin-${Math.floor(1e3*Math.random())}-${(new Date).getTime()}`,d=document.createElement("iframe");d.setAttribute("data-kami-assignment-detector",!0),d.setAttribute("data-kami-grader-container-id",e),d.setAttribute("data-kami-assignment-detector-loading-spin-id",o),d.setAttribute("data-kami-alternate-course-id",a),d.setAttribute("data-kami-alternate-course-work-id",n),d.setAttribute("data-kami-auth-user",i),d.src=`https://classroom.google.com/u/${i}/c/${a}/a/${n}/details`,d.style.display="none",document.body.appendChild(d);const s=document.createElement("div");s.id=o,s.classList.add("kami-per-page-grader-loading-spin");const c=document.createElement("span");c.textContent="Checking assignment type...",c.classList.add("text"),s.appendChild(c),document.body.appendChild(s)},findCourseIdInIframe=function(e){for(const t of window.parent.document.querySelectorAll(`[href="/c/${e}"]`)){const e=t.getAttribute("data-id");if(e)return e}},findCourseWorkIdInIframe=function(){const e=window.parent.document.querySelector(".I0naMd")||document.querySelector(".I0naMd");return e&&e.getAttribute("data-stream-item-id")};observers.customGrader=new MutationObserver((function(e){if(window.location.href.includes("details")&&window.self!==window.top){if(!(window.frameElement&&window.frameElement.getAttribute("data-kami-assignment-detector")))return;for(const t of e){if(!t.addedNodes)return;const e=findCourseWorkIdInIframe(),r=document.querySelector(".cSyPgb.WInaFd.QRiHXd");if(e&&r){const t=r.textContent.endsWith("Kami")||r.textContent.endsWith("kami-dev"),a=window.frameElement.getAttribute("data-kami-grader-container-id"),n=window.frameElement.getAttribute("data-kami-assignment-detector-loading-spin-id"),i=window.frameElement.getAttribute("data-kami-alternate-course-id"),o=window.frameElement.getAttribute("data-kami-alternate-course-work-id");window.parent.postMessage({from_kami_detector:!0,is_kami_assignment:t,grader_container_id:a,loading_spin_id:n,alternate_course_id:i,alternate_course_work_id:o,auth_user:window.frameElement.getAttribute("data-kami-auth-user"),course_id:findCourseIdInIframe(i),course_work_id:e}),observers.customGrader.disconnect()}return}}else if(window.location.href.includes("submissions"))for(const t of e){if(!t.addedNodes)return;return void document.querySelectorAll(".Y5vSD.TIunU.xPSjRb").forEach((e=>{if(!e||e.querySelector(".kami-per-page-grader-container"))return;const t=`kami-button-${Math.floor(1e3*Math.random())}-${(new Date).getTime()}`;attachPerPageGraderButtonGCSubmission(e,t),mountDetailsIframe(t,UrlMatcher.extractDataFromAssignmentPage)}))}else if(UrlMatcher.isClassroomGrader(window.location.href))for(const t of e){if(!t.addedNodes)return;const e=document.querySelector(".dnTXKd");if(!e||e.querySelector(".kami-per-page-grader-container"))return;const r=`kami-button-${Math.floor(1e3*Math.random())}-${(new Date).getTime()}`;return attachPerPageGraderButtonGCGrader(e,r),void mountDetailsIframe(r,UrlMatcher.extraDataFromGraderPage)}})),window.addEventListener("message",(e=>{if("https://classroom.google.com"!==e.origin)return;const{from_kami_detector:t,is_kami_assignment:r,grader_container_id:a,loading_spin_id:n,alternate_course_id:i,alternate_course_work_id:o,auth_user:d,course_id:s,course_work_id:c}=e.data;if(!t)return;const u=document.getElementById(a),m=u&&u.querySelector("a");r&&m&&(m.addEventListener("click",(function(){const e=buildGradeByPageUrl(i,o,d,s,c);window.open(e,"_blank")})),u.style.visibility="visible");const{frameElement:l}=e.source;l&&l.remove();const g=document.getElementById(n);g&&g.remove()})),observers.customGrader.observe(document.body,{childList:!0,subtree:!0});